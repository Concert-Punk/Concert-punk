<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <th:block th:replace="partials :: partials"></th:block>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
          rel="stylesheet">

    <nav th:replace="partials :: navbar"></nav>
    <style>

        /* default */
        *,
        *::after,
        *::before {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* body */
        body {
            background: black;


        }

        /* .flip-card-container */
        .flip-card-container {
            --hue: 150;
            --primary: hsl(var(--hue), 50%, 50%);
            --white-1: hsl(0, 0%, 90%);
            --white-2: hsl(0, 0%, 80%);
            --dark: hsl(var(--hue), 25%, 10%);
            --grey: hsl(0, 0%, 50%);

            width: 310px;
            height: 500px;
            margin: 40px;

            perspective: 1000px;
        }

        /* .flip-card */
        .flip-card {
            width: inherit;
            height: inherit;

            position: relative;
            transform-style: preserve-3d;
            transition: .6s .1s;
        }

        /* hover and focus-within states */
        .flip-card-container:hover .flip-card,
        .flip-card-container:focus-within .flip-card {
            transform: rotateY(180deg);
        }

        /* .card-... */
        #card-front,
        .card-back {
            width: 100%;
            height: 100%;
            border-radius: 24px;

            background: var(--dark);
            position: absolute;
            top: 0;
            left: 0;
            overflow: hidden;

            backface-visibility: hidden;

            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* .card-front */
        .card-front {
            transform: rotateY(0deg);
            z-index: 2;
        }

        /* .card-back */
        .card-back {
            transform: rotateY(180deg);
            z-index: 1;
        }

        /* figure */
        figure {
            z-index: -1;
        }

        /* figure, .img-bg */
        figure,
        .img-bg {
            position: absolute;
            width: 90%;
            height: 90%;
        }

        /* img */
        img {
            height: 100%;
            width:100%;
            border-radius: 24px;
        }

        /* figcaption */
        .artistName {
            display: block;

            width: auto;
            margin-top: 12%;
            padding: 8px 22px;

            font-weight: bold;
            line-height: 1.6;
            letter-spacing: 2px;
            word-spacing: 6px;
            text-align: right;

            position: absolute;
            top: 0;
            right: 12px;

            color: var(--white-1);

        }

        /* .img-bg */
        .img-bg {
            background: hsla(var(--hue), 25%, 10%, .5);
        }

        .card-front .img-bg {
            clip-path: polygon(0 20%, 100% 40%, 100% 100%, 0 100%);
        }

        .card-front .img-bg::before {
            content: "";

            position: absolute;
            top: 34%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(18deg);

            width: 100%;
            height: 6px;
            border: 1px solid var(--primary);
            border-left-color: transparent;
            border-right-color: transparent;

            transition: .1s;
        }

        .card-back .img-bg {
            clip-path: polygon(0 0, 100% 0, 100% 80%, 0 60%);
        }

        /* hover state */
        .flip-card-container:hover .card-front .img-bg::before {
            display: flex;
            width: 6px;
            border-left-color: var(--primary);
            border-right-color: var(--primary);

        }

        /* ul */
        #details {
            padding-top: 50%;
            margin: 0 auto;
            width: 70%;
            height: 100%;

            list-style: none;
            color: var(--white-1);

            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        /* li */
        #detailItems {
            width: 100%;
            margin-top: 12px;
            padding-bottom: 12px;

            font-size: 14px;
            text-align: center;

            position: relative;
        }

        #detailItems:nth-child(2n) {
            color: var(--white-2);
        }

        #detailItems:not(:last-child)::after {
            content: "";

            position: absolute;
            bottom: 0;
            left: 0;

            width: 100%;
            height: 1px;

            background: currentColor;
            opacity: .2;
        }

        /* button */
        #saveBtn {
            font-family: inherit;
            font-weight: bold;
            color: var(--white-1);

            letter-spacing: 2px;

            padding: 9px 20px;
            border: 1px solid var(--grey);
            border-radius: 1000px;
            background: transparent;
            transition: .3s;

            cursor: pointer;
        }

        #saveBtn:hover,
        #saveBtn:focus {
            color: var(--primary);
            background: hsla(var(--hue), 25%, 10%, .2);
            border-color: currentColor;
        }

        #saveBtn:active {
            transform: translate(2px);
        }

        /* .design-container */
        .design-container {
            --tr: 90;
            --op: .5;

            width: 100%;
            height: 100%;

            background: transparent;
            position: absolute;
            top: 0;
            left: 0;

            pointer-events: none;
        }

        /* .design */
        .design {
            display: block;

            background: var(--grey);
            position: absolute;

            opacity: var(--op);
            transition: .3s;
        }

        .design--1,
        .design--2,
        .design--3,
        .design--4 {
            width: 1px;
            height: 100%;
        }

        .design--1,
        .design--2 {
            top: 0;
            transform: translateY(calc((var(--tr) - (var(--tr) * 2)) * 1%))
        }

        .design--1 {
            left: 20%;
        }

        .design--2 {
            left: 80%;
        }

        .design--3,
        .design--4 {
            bottom: 0;
            transform: translateY(calc((var(--tr) + (var(--tr) - var(--tr))) * 1%))
        }

        .design--3 {
            left: 24%;
        }

        .design--4 {
            left: 76%;
        }

        .design--5,
        .design--6,
        .design--7,
        .design--8 {
            width: 100%;
            height: 1px;
        }

        .design--5,
        .design--6 {
            left: 0;
            transform: translateX(calc((var(--tr) - (var(--tr) * 2)) * 1%));
        }

        .design--5 {
            top: 41%;
        }

        .design--6 {
            top: 59%;
        }

        .design--7,
        .design--8 {
            right: 0;
            transform: translateX(calc((var(--tr) + (var(--tr) - var(--tr))) * 1%))
        }

        .design--7 {
            top: 44%;
        }

        .design--8 {
            top: 56%;
        }

        /* states */
        button:hover+.design-container,
        button:active+.design-container,
        button:focus+.design-container {
            --tr: 20;
            --op: .7;
        }




    </style>
</head>


<style>

    /* default */
    *,
    *::after,
    *::before {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    /* body */
    body {
        background: black;


    }

    /* .flip-card-container */
    .flip-card-container {
        --hue: 150;
        --primary: hsl(var(--hue), 50%, 50%);
        --white-1: hsl(0, 0%, 90%);
        --white-2: hsl(0, 0%, 80%);
        --dark: hsl(var(--hue), 25%, 10%);
        --grey: hsl(0, 0%, 50%);

        width: 310px;
        height: 500px;
        margin: 40px;

        perspective: 1000px;
    }

    /* .flip-card */
    .flip-card {
        width: inherit;
        height: inherit;

        position: relative;
        transform-style: preserve-3d;
        transition: .6s .1s;
    }

    /* hover and focus-within states */
    .flip-card-container:hover .flip-card,
    .flip-card-container:focus-within .flip-card {
        transform: rotateY(180deg);
    }

    /* .card-... */
    #card-front,
    .card-back {
        width: 100%;
        height: 100%;
        border-radius: 24px;

        background: var(--dark);
        position: absolute;
        top: 0;
        left: 0;
        overflow: hidden;

        backface-visibility: hidden;

        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* .card-front */
    .card-front {
        transform: rotateY(0deg);
        z-index: 2;
    }

    /* .card-back */
    .card-back {
        transform: rotateY(180deg);
        z-index: 1;
    }

    /* figure */
    figure {
        z-index: -1;
    }

    /* figure, .img-bg */
    figure,
    .img-bg {
        position: absolute;
        width: 90%;
        height: 90%;
    }

    /* img */
    img {
        height: 100%;
        width:100%;
        border-radius: 24px;
    }

    /* figcaption */
    .artistName {
        display: block;

        width: auto;
        margin-top: 12%;
        padding: 8px 22px;

        font-weight: bold;
        line-height: 1.6;
        letter-spacing: 2px;
        word-spacing: 6px;
        text-align: right;

        position: absolute;
        top: 0;
        right: 12px;

        color: var(--white-1);

    }

    /* .img-bg */
    .img-bg {
        background: hsla(var(--hue), 25%, 10%, .5);
    }

    .card-front .img-bg {
        clip-path: polygon(0 20%, 100% 40%, 100% 100%, 0 100%);
    }

    .card-front .img-bg::before {
        content: "";

        position: absolute;
        top: 34%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(18deg);

        width: 100%;
        height: 6px;
        border: 1px solid var(--primary);
        border-left-color: transparent;
        border-right-color: transparent;

        transition: .1s;
    }

    .card-back .img-bg {
        clip-path: polygon(0 0, 100% 0, 100% 80%, 0 60%);
    }

    /* hover state */
    .flip-card-container:hover .card-front .img-bg::before {
        display: flex;
        width: 6px;
        border-left-color: var(--primary);
        border-right-color: var(--primary);

    }

    /* ul */
    #details {
        padding-top: 50%;
        margin: 0 auto;
        width: 70%;
        height: 100%;

        list-style: none;
        color: var(--white-1);

        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    /* li */
    #detailItems {
        width: 100%;
        margin-top: 12px;
        padding-bottom: 12px;

        font-size: 14px;
        text-align: center;

        position: relative;
    }

    #detailItems:nth-child(2n) {
        color: var(--white-2);
    }

    #detailItems:not(:last-child)::after {
        content: "";

        position: absolute;
        bottom: 0;
        left: 0;

        width: 100%;
        height: 1px;

        background: currentColor;
        opacity: .2;
    }

    /* button */
    #saveBtn {
        font-family: inherit;
        font-weight: bold;
        color: var(--white-1);

        letter-spacing: 2px;

        padding: 9px 20px;
        border: 1px solid var(--grey);
        border-radius: 1000px;
        background: transparent;
        transition: .3s;

        cursor: pointer;
    }

    #saveBtn:hover,
    #saveBtn:focus {
        color: var(--primary);
        background: hsla(var(--hue), 25%, 10%, .2);
        border-color: currentColor;
    }

    #saveBtn:active {
        transform: translate(2px);
    }

    /* .design-container */
    .design-container {
        --tr: 90;
        --op: .5;

        width: 100%;
        height: 100%;

        background: transparent;
        position: absolute;
        top: 0;
        left: 0;

        pointer-events: none;
    }

    /* .design */
    .design {
        display: block;

        background: var(--grey);
        position: absolute;

        opacity: var(--op);
        transition: .3s;
    }

    .design--1,
    .design--2,
    .design--3,
    .design--4 {
        width: 1px;
        height: 100%;
    }

    .design--1,
    .design--2 {
        top: 0;
        transform: translateY(calc((var(--tr) - (var(--tr) * 2)) * 1%))
    }

    .design--1 {
        left: 20%;
    }

    .design--2 {
        left: 80%;
    }

    .design--3,
    .design--4 {
        bottom: 0;
        transform: translateY(calc((var(--tr) + (var(--tr) - var(--tr))) * 1%))
    }

    .design--3 {
        left: 24%;
    }

    .design--4 {
        left: 76%;
    }

    .design--5,
    .design--6,
    .design--7,
    .design--8 {
        width: 100%;
        height: 1px;
    }

    .design--5,
    .design--6 {
        left: 0;
        transform: translateX(calc((var(--tr) - (var(--tr) * 2)) * 1%));
    }

    .design--5 {
        top: 41%;
    }

    .design--6 {
        top: 59%;
    }

    .design--7,
    .design--8 {
        right: 0;
        transform: translateX(calc((var(--tr) + (var(--tr) - var(--tr))) * 1%))
    }

    .design--7 {
        top: 44%;
    }

    .design--8 {
        top: 56%;
    }

    /* states */
    button:hover+.design-container,
    button:active+.design-container,
    button:focus+.design-container {
        --tr: 20;
        --op: .7;
    }




</style>

<body>
<!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
<div id="playerWrapper">
    <div id="player"></div>
</div>


<!--<p class="videoToggler" data-id="uMyuSHewmks">Press here to play Naruto Intro</p>-->
<!--<p class="videoToggler" data-id="tgbNymZ7vqY">Press here to play Muppets</p>-->
<form>
    <label for="search-input"></label><input id="search-input" type="text" name="Search Artist"/>
    <input id="add-artist" type="submit" value="Search"/>
</form>

<div class=" container searchResults" style="display: flex; flex-wrap: wrap">
    <p id="concertSchedule"></p>
</div>

<div id="relatedArtistContainer"></div>

<script>

    let vidWidth = 400;
    let vidHeight = 300;
    let vidResults = 10;


    //The q parameter specifies the query term to search for.
    // run get request on api
    function youtubeSearch(q) {
        $.get(
            "https://www.googleapis.com/youtube/v3/search", {
                part: "snippet, id",
                q: q,
                type: "video",
                maxResults: vidResults,
                key: 'AIzaSyBQg9LOBnyBOlvU4Ym-IdApfCI9mjPWIh4',

            },
            function (youTubeBasicData) {
                let output;
                $.each(youTubeBasicData.items, function (i, item) {

                    console.log(item);
                    let videoId = item.id.videoId;
                    // document.getElementById('youTube').innerHTML  += '<li><iframe height="' + vidHeight + '" width="' + vidWidth + '" src=\"https://www.youtube.com/embed/' + videoId + '\"></li>';
                    $("#youTube").html(output);
                    //  console.log(item.snippet.description);


                    let durationUrl = 'https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=' + videoId + '&key=AIzaSyBQg9LOBnyBOlvU4Ym-IdApfCI9mjPWIh4'
                    let viewCountUrl = 'https://www.googleapis.com/youtube/v3/videos?part=statistics&id=' + videoId + '&key=AIzaSyBQg9LOBnyBOlvU4Ym-IdApfCI9mjPWIh4'
                    axios.get(durationUrl).then(resp => {
                        //1.Duration and plays dont always match appropriate track, will need to match everything by the videoID
                        //2.I need to iterate through them not happening so far
                        axios.get(viewCountUrl).then(response => {
                            //Grabbing onclick action on the table rows just need to plug in function/variable to pass videourl to play it.
                            let dynamicBoii = `   <tr data-id="${item.id.videoId}" class="videoToggler" >
                        <th scope="row"><a href=""> <span class="material-icons">
    play_circle

  </span></a></th>
                        <td id="description">${item.snippet.title}</td>
                        <td id="artist">${item.snippet.channelTitle}</td>
                        <td id="duration">${resp.data.items[0].contentDetails.duration}</td>
                        <td id="viewCount">${response.data.items[0].statistics.viewCount}</td>
                    </tr>`;
                            document.getElementById('youtubeData').innerHTML += dynamicBoii;

                            console.log(response.data)
                            console.log(response.data.items[0].statistics.viewCount)

                        })


                        console.log(resp.data);
                    });


                });

            }
        );
    }


    $(document).on("click", "#add-artist", function (event) {
        event.preventDefault();
        let q = $("#search-input").val().trim();
        youtubeSearch(q);


    });

    $(document).on("click", ".search-keyword", function () {
        let q = $(this).text();
        youtubeSearch(q);
    });

    //Sams Script
    let player = null;
    let tag = document.createElement('script');

    tag.src = "https://www.youtube.com/iframe_api";
    let firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    function onYouTubeIframeAPIReady() {
        console.log("youTube is ready")
        $(document).on("click", 'tr.videoToggler', function () {
            let youTubeId = $(this).attr('data-id');

            document.querySelector("#playerWrapper").innerHTML = `<div id="player"></div>`


            player = new YT.Player('player', {
                height: '390',
                width: '640',
                videoId: youTubeId,
                playerVars: {
                    'playsinline': 1
                },
                events: {
                    'onReady': onPlayerReady,
                }
            });

        })
        // document.querySelectorAll("tr.videoToggler").forEach(function (e) {
        //     e.addEventListener("click", function (e) {
        //         console.log("Triggering channge");
        //     })
        // })


    }


    function onPlayerReady(event) {
        console.log(event.target)

        event.target.playVideo();
        event.target.setVolume(100);
    }


</script>
<script>function handleSearch(artist) {
    let queryURL = "https://app.ticketmaster.com/discovery/v2/events.json?&countryCode=US&sort'date,asc'&keyword=" +
        artist + "&apikey=oiPygQlAdZyxwwtbOi99vUDR8HTGkuV8"
    $.ajax({
        type: "GET",
        url: queryURL,
        async: true,
        dataType: "json",
        success: function (response) {
            if (response.hasOwnProperty('_embedded')) {
                console.log("It has property embedded");
                console.log(response)
                let evts = response._embedded.events;
                let concertHeader;
                for (let i = 0; i < 5; i++) {
                    console.log(response._embedded.events[i]);
                    let concertDiv = $("<div class='item'>");
                    // let images = evts[i]_embedded.events[0].images[0]
                    let tourName = evts[i].name;
                    let tourDate = evts[i].dates.start.localDate;
                    let tourTime = evts[i].dates.start.localTime;
                    let tourTimeC = moment(tourTime, "HH:mm").format('hh:mm a');
                    let venue = evts[i]._embedded.venues[0].name;
                    let showCity = evts[i]._embedded.venues[0].city.name;
                    let showState = evts[i]._embedded.venues[0].state.stateCode;
                    let buyLink = evts[i].url;
                    let results =`  <div class="flip-card-container" style="--hue: 220 ">
  <div class="flip-card">

    <div class="card-front" id="card-front">
      <figure>
        <div class="img-bg"></div>
        <img src="https://source.unsplash.com/random" alt="Brohm Lake">
        <h4 class="artistName">${tourName}</h4>
      </figure>

      <ul id="details">
        <li id  ="detailItems">${tourDate}</li>
        <li>${venue}</li>
        <li>${tourTime}</li>
        <li>Detail 4</li>
        <li>Detail 5</li>
      </ul>
    </div>

    <div class="card-back">
      <figure>
        <div class="img-bg"></div>
        <img src="" alt="Brohm Lake">
      </figure>
      <button class="saveEvent"  type="submit" id="saveBtn">Save</button>
      <div class="design-container">
        <span class="design design--1"></span>
        <span class="design design--2"></span>
        <span class="design design--3"></span>
        <span class="design design--4"></span>
        <span class="design design--5"></span>
        <span class="design design--6"></span>
        <span class="design design--7"></span>
        <span class="design design--8"></span>
      </div>
    </div>

  </div>
</div>
`

//                     `<p style="color:white">Artist/Tour Name:${tourName}</p>
//
//                      <p style="color:white">Concert Date:${tourDate}</p>
//                       <p style="color:white">Time:${tourTimeC}</p>
// <p style="color:white">Venue:${venue}</p>
// <p style="color:white">${showCity}</p><p style="color:white">${showState}</p>
// <p style="color: rgba(12, 105, 128, 0.99)">Ticket Link:</p><a href="${buyLink}"><p style="color: rgba(12, 105, 128, 0.99)">Click Here for Tickets</p></a>`

                    // let results = $("<div class='searchResult'>").html("<strong>Artist/Tour Name: " + tourName + "</strong><br>" +
                    //     "Concert Date: " + tourDate + " Time: " + tourTimeC + "<br>" +
                    //     "Venue: " + venue + " - " + showCity + ", " + showState + "<br>" +
                    //     "Ticket Link: " + "<a href='" + buyLink + "' target=_'blank'>Click Here for Tickets</a>" + "<br>");
                    concertDiv.prepend(results);
                    $("#concertSchedule").append(concertDiv);
                }
            } else {
                $("#concertSchedule").html("<em>" + "There currently isn't any event information for " + artist + ".</em>");
            }
        },
        error: function (xhr, status, err) {
            // This time, we do not end up here!
        }
    });
}

$(document).on('click', '#add-artist', function (event) {
    event.preventDefault();
    let artist = $("#search-input").val().trim();
    console.log(artist);
    handleSearch(artist);
})
</script>
<br>
<br>
<br>

<p><span id="youTube"></span></p>
<table class="table table-hover table-dark" id="tableId">
    <thead>
    <tr class="videoToggler">

        <th scope="col"></th>
        <th scope="col">Title</th>
        <th scope="col">Artist</th>
        <th scope="col">Dur</th>
        <th scope="col">Plays</th>
    </tr>
    </thead>
    <tbody id="youtubeData">

    </tbody>
</table>

<script>$(document).ready(function () {
    let clickedKeyword = "";

    function createAccessToken(callback) {
        let queryURL = "https://accounts.spotify.com/api/token";
        $.ajax({
            url: queryURL,
            method: "POST",
            data: {
                "grant_type": "client_credentials"
            },
            headers: {
                "Authorization": "Basic " + btoa("e81f9ea2e64e43cb834bd3488f779729" + ":" + "3850ad8ffc3c46babb2c6526acb943da")
            }
        }).done(function (response) {
            console.log(response.access_token);
            sessionStorage.setItem("accessToken", response.access_token);
            callback(response.access_token);
        });

    }


    function getAccessToken(callback) {
        let accessToken = sessionStorage.getItem("accessToken");
        if (accessToken !== null) {
            callback(accessToken);
        } else {
            createAccessToken(callback);
        }
    }

    function searchWithToken(accessToken) {
        let artist = $("#search-input").val().trim();
        spotifySearch(accessToken, artist);
        $("#displayArtist").text(titleCase(artist));
    }

    function reSearch(accessToken) {
        spotifySearch(accessToken, encodeURI(clickedKeyword));
    }

    function spotifySearch(accessToken, artist) {
        console.log(accessToken);
        let queryURL = "https://api.spotify.com/v1/search?q=" + artist + "&type=artist&market=US&limit=10";
        console.log(queryURL);
        console.log(artist);
        $.ajax({
            url: queryURL,
            method: "GET",
            headers: {
                "Authorization": "Bearer " + accessToken,
            }
        }).done(function (response) {
            let results = response;
            console.log(results);
            let artistID = results.artists.items[0].id;
            // console.log(results.artists.items[0]);
            spotifyRelatedArtist(accessToken, artistID);
        });

    }


    function spotifyRelatedArtist(accessToken, artistID) {
        let queryURL = "https://api.spotify.com/v1/artists/" + artistID + "/related-artists";
        $.ajax({
            url: queryURL,
            method: "GET",
            headers: {
                "Authorization": "Bearer " + accessToken,
            }
        }).done(function (response) {
            let results = response;
            for (let j = 0; j < 5; j++) {
                let relatedArtist = results.artists[j].name;

                let displayRelatedArtist = $('<li style="color:white" class="search-keyword">' + relatedArtist + '</li>');

                $("#relatedArtistContainer").append(displayRelatedArtist);
            }

        });

    }

    function titleCase(str) {
        str = str.toLowerCase().split(' ');
        for (let i = 0; i < str.length; i++) {
            str[i] = str[i].split('');
            str[i][0] = str[i][0].toUpperCase();
            str[i] = str[i].join('');
        }
        return str.join(' ');
    }


    $("#add-artist").on("click", function (event) {
        event.preventDefault();
        getAccessToken(searchWithToken);
    });
    $(document).on("click", ".search-keyword", function (event) {
        event.preventDefault();
        clickedKeyword = $(this).text();
        getAccessToken(reSearch);
        $("#displayArtist").text($(this).text());

    });


});</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"
        integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</body>
</html>
